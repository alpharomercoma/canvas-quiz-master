(()=>{"use strict";var e,t;function n(e,t){return Object.fromEntries(Object.entries(e).filter((([e,n])=>t(n,e))))}!function(e){e.TRUE="true",e.FALSE="false",e.PARTIAL="partial"}(e||(e={})),function(e){e[e.MULTIPLE_CHOICE=0]="MULTIPLE_CHOICE",e[e.TRUE_FALSE=1]="TRUE_FALSE",e[e.FILL_IN_BLANK=2]="FILL_IN_BLANK",e[e.FILL_IN_MULRIPLE_BLANKS=3]="FILL_IN_MULRIPLE_BLANKS",e[e.MULTIPLE_ANSWER=4]="MULTIPLE_ANSWER",e[e.MULTIPLE_DROPDOWN=5]="MULTIPLE_DROPDOWN",e[e.MATCHING=6]="MATCHING",e[e.NUMERICAL_ANSWER=7]="NUMERICAL_ANSWER",e[e.FORMULA_QUESTION=8]="FORMULA_QUESTION",e[e.ESSAY_QUESTION=9]="ESSAY_QUESTION"}(t||(t={}));const s="multiple_choice_question",i="true_false_question",r="short_answer_question",o="fill_in_multiple_blanks_question",l="multiple_answers_question",c="multiple_dropdowns_question",a="matching_question",u="numerical_question",d="calculated_question",m="essay_question";class f{displayMatching(e,t){if(!e)return;const n=document.querySelectorAll(`#question_${t} select`);for(const e of n)if(e.value)return;const s=e.bestAnswer;for(let e in s.dynamicFields)if(e.includes("answer_")){const n=`question_${t}_${e}`,i=document.getElementById(n);i.value=s.dynamicFields[e],i.dispatchEvent(new Event("change",{bubbles:!0}))}}displayMultipleDropdowns(e,t){if(!e)return;const n=document.getElementById(`question_${t}`),s=document.querySelectorAll(`#question_${t} select`);for(const e of s)if(e.value)return;const i=e.bestAnswer;for(let e in i.dynamicFields)if(e.includes("answer_id_for")){const t=i.dynamicFields[e],s=n.querySelector(`option[value='${t}']`).parentElement;s.value=t,s.dispatchEvent(new Event("change",{bubbles:!0}))}}displayMultipleAnswer(e,t){if(!e)return;const n=document.querySelectorAll(`#question_${t} input[type="checkbox"]`);for(const e of n)if(e.checked)return;const s=e.bestAnswer;for(let e in s.dynamicFields)if(e.includes("answer_")){const n=`question_${t}_${e}`,i=document.getElementById(n);i.checked=1===parseInt(s.dynamicFields[e]),i.dispatchEvent(new Event("change",{bubbles:!0}))}}displayMultipleChoise(t,n){if(!t)return;const s=new Set;for(const n of t.attempts){const t=parseInt(n.text);n.correct===e.TRUE||isNaN(t)||s.add(t)}for(let e of s){const t=`question_${n}_answer_${e}`;document.getElementById(t).parentElement.nextElementSibling.classList.add("incorrect-answer")}const i=document.querySelectorAll(`#question_${n} input`);for(let e of i)if(e.checked)return;if(!("answer_id"in t.bestAnswer.dynamicFields))return;const r=`question_${n}_answer_${t.bestAnswer.text}`,o=document.getElementById(r);o&&(function(e){return e.parentElement.nextElementSibling.className.includes("incorrect-answer")}(o)||(o.checked=!0,o.dispatchEvent(new Event("change",{bubbles:!0}))))}displayFillInBlank(e,t){if(!e)return;const n=e.bestAnswer;let s=null;const i=document.getElementsByName(`question_${t}`);for(let e of i)if("INPUT"===e.tagName){s=e;break}s.value||(s.value=n.text,s.dispatchEvent(new Event("change",{bubbles:!0})))}displayEssay(e,t,n=15,s=500){if(!e)return;const i=e.latestAnswer;let r;setTimeout((()=>{try{r=document.getElementById(`question_${t}_question_text`);const e=r.nextElementSibling.querySelector("#question_input_0_ifr"),n=e.contentDocument?e.contentDocument:e.contentWindow.document;setTimeout((()=>{const e=n.getElementById("tinymce");'<p><br data-mce-bogus="1"></p>'==e.innerHTML&&(e.innerHTML=i.text,e.dispatchEvent(new Event("input",{bubbles:!0})))}),0)}catch(s){n>0?this.displayEssay(e,t,n-1):r.innerHTML+=`<b><div>Previous answer</div></b><p>${i.text}</p>`}}),s)}displayFillInMultipleBlank(e,t){if(!e)return;const n=structuredClone(e.bestAnswer.dynamicFields);for(const t of e.attempts)for(const e in t.dynamicFields)if(e.startsWith("answer_id_for_")&&null!=t.dynamicFields[e]){const s=`answer_for${e.replace("answer_id_for","")}`;n[e]=t.dynamicFields[e],n[s]=t.dynamicFields[s]}const s=document.getElementById(`question_${t}_question_text`).parentElement,i=Object.keys(n).filter((e=>e.includes("answer_for"))).map((e=>{const t=`answer_id_for${e.replace("answer_for","")}`;return`<li class="${null!=n[t]?"checkmark":"cross"}">${e.replace(/_/g," ")}: ${n[e]}</li>`})),r=Object.keys(e.latestAnswer.dynamicFields).filter((e=>e.includes("answer_for"))).map((t=>{const n=`answer_id_for${t.replace("answer_for","")}`;return`<li class="${null!=e.latestAnswer.dynamicFields[n]?"checkmark":"cross"}">${t.replace(/_/g," ")}: ${e.latestAnswer.dynamicFields[t]}</li>`})),o=`\n      <div class="fill-in-multiple-blank-extra-info">\n        <div class="answers-panel" >\n          <div class="best-answer">\n            <h4>Best Answer</h4>\n            <ul class="answer-list">\n              ${i.join("")}\n            </ul>\n          </div>\n          <br>\n          <div class="latest-answer">\n            <h4>Latest Answer</h4>\n            <ul class="answer-list">\n              ${r.join("")}\n            </ul>\n          </div>\n        </div>\n      </div>\n    `,l=(new DOMParser).parseFromString(o,"text/html");s.prepend(l.body.firstElementChild)}}!function(){var t,p,_,w;t=this,p=void 0,w=function*(){const t=window.location.href,p=parseInt(t.split("courses/")[1].split("/")[0]),_=parseInt(t.split("quizzes/")[1].split("/")[0]),w=t.split("/"),y=`${w[0]}//${w[2]}/`;p?_||console.error("Unable to retrieve quiz id"):console.error("Unable to retrieve course id");const E=yield function(e,t,n){return s=this,i=void 0,o=function*(){const s=`${n}api/v1/courses/${e}/quizzes/${t}/`,i=s+"submissions",[r,o]=yield Promise.all([fetch(s),fetch(i)]),[l,c]=yield Promise.all([r.text(),o.text()]),[a,u]=[JSON.parse(l),JSON.parse(c).quiz_submissions],d=a.assignment_id,m=u.at(-1).user_id;if(!d)throw new Error("Unable to retrieve assignmentId");if(!m)throw new Error("Unable to retrieve userId");return fetch(`${n}api/v1/courses/${e}/assignments/${d}/submissions/${m}?include[]=submission_history`).then((e=>e.text())).then((e=>JSON.parse(e).submission_history))},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{c(o.next(e))}catch(e){t(e)}}function l(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof r?s:new r((function(e){e(s)}))).then(n,l)}c((o=o.apply(s,i||[])).next())}));var s,i,r,o}(p,_,y),h=function(t){if(!t[0].submission_data)return null;console.log(t);const s={};for(let i=0;i<t.length;i++){const r=t[i];for(let t of r.submission_data){const i=t.question_id;let r;1==t.correct?r=e.TRUE:0==t.correct?r=e.FALSE:"partial"==t.correct&&(r=e.PARTIAL);const o={correct:r,text:t.text,points:t.points,dynamicFields:n(t,((e,t)=>t.startsWith("answer")))};i in s||(s[i]={attempts:[],bestAnswer:o,latestAnswer:o});const l=s[i];l.attempts.push(o),(1==t.correct||l.bestAnswer.points<t.points)&&(l.bestAnswer=o)}}return s}(E);if(console.log(h),!h)return null;!function(e){const t=document.getElementsByClassName("question"),n=document.getElementsByClassName("question_type"),p=t.length,_=new f,w=function(){const e=document.getElementsByClassName("question_points_holder");let t=[];for(let n of e){const e=n.parentElement.classList;for(let s=0;s<e.length;s++)"header"!=e[s]||t.push(n)}return t}(),y=function(){const e=[],t=document.getElementsByClassName("original_question_text");for(let n of t)e.push(parseInt(n.nextElementSibling.id.split("_")[1]));return e}();for(let t=0;t<p;t++){const f=n[t].innerText,p=y[t];if(e[p]){const n=e[p];try{switch(f){case m:_.displayEssay(n,p);case a:_.displayMatching(n,p);break;case c:_.displayMultipleDropdowns(n,p);break;case l:_.displayMultipleAnswer(n,p);break;case s:case i:_.displayMultipleChoise(n,p);break;case r:case d:case u:_.displayFillInBlank(n,p);break;case o:_.displayFillInMultipleBlank(n,p)}}catch(e){console.error(`Failed to display question results for ${f}.`,n)}const y=Math.round(100*n.bestAnswer.points)/100;y==parseFloat(w[t].innerText)?w[t].classList.add("correct-answer"):w[t].classList.add("incorrect-answer"),w[t].innerText=`${y} out of ${w[t].innerText}`}else w[t].innerText=`(New Question) ${w[t].innerText}`}}(h)},new((_=void 0)||(_=Promise))((function(e,n){function s(e){try{r(w.next(e))}catch(e){n(e)}}function i(e){try{r(w.throw(e))}catch(e){n(e)}}function r(t){var n;t.done?e(t.value):(n=t.value,n instanceof _?n:new _((function(e){e(n)}))).then(s,i)}r((w=w.apply(t,p||[])).next())}))}();const p=document.createElement("script");p.innerHTML="confirm = function(){return true;}",document.body.appendChild(p)})();